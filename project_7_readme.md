# Project 7 - WordPress Pentesting

Time spent: **12** hours spent in total

> Objective: Find, analyze, recreate, and document **five vulnerabilities** affecting an old version of WordPress

## Pentesting Report

1. Authenticated Stored Cross-Site Scripting (XSS) in YouTube URL Embeds
  - [ ] Summary: makes a link that looks like it is for youtube but embeds in the code	
    - Vulnerability types:XSS
    - Tested in version:4.2
    - Fixed in version:4.2.13
  - [ ] GIF Walkthrough: https://imgur.com/a/vl9AOdv
  - [ ] Steps to recreate: create a post and in the post
		put in  "[embed src='https://youtube.com/embed/123\x3csvg onload=alert(69)\x3e'][/embed]" it embed the code to trigger an alert in a youtube link
  - [ ] Affected source code:
$embed = $wp_embed->autoembed( "https://youtube.com/watch?v={$matches[2]}" );
was changed to 
$embed = $wp_embed->autoembed( sprintf( "https://youtube.com/watch?v=%s", urlencode( $matches[2] ) ) );
    - [Link 1
https://github.com/WordPress/WordPress/commit/419c8d97ce8df7d5004ee0b566bc5e095f0a6ca8
2. Legacy Theme Preview Cross-Site Scripting (XSS)
  - [ ] Summary: a simple XSS with an onmouse over to alert
    - Vulnerability types: XSS
    - Tested in version: 4.2
    - Fixed in version: 4.2.4
  - [ ] GIF Walkthrough: https://imgur.com/a/fiOSl5o
  - [ ] Steps to recreate: make a text post with
	<a onmouseover= "alert('All Your Base Belong to me')" > Free music and candy-- click here</a>
  - [ ] Affected source code:
return $content; 
is replaced with
 return preg_replace_callback( "|(<a.*?href=([\"']))(.*?)([\"'].*?>)|", 'preview_theme_ob_filter_callback', $content );
to parse the data
    - https://core.trac.wordpress.org/changeset/33549
3. Authenticated Stored Cross-Site Scripting (XSS)
  - [ ] Summary: 
    - Vulnerability types:XSS
    - Tested in version:4.2
    - Fixed in version: 4.2.3
  - [ ] GIF Walkthrough: https://imgur.com/a/2JpNkDY
  - [ ] Steps to recreate: Post in text with exploit
	<a href="[caption code=">]</a><a title=" onmouseover=alert('AllYourBaseBelongToUS!')  ">Click here to download more RAM</a>
  - [ ] Affected source code:
	added code to deal with html tags
 // Strip newlines from all elements.
 	$pee = wp_replace_in_html_tags( $pee, array( "\n" => " " ) );
references a new class that is added that is really long that parces the string to make sure it does not allow exploitation.
/**
 	* Replace characters or phrases within HTML elements only.
 	*
 	* @since 4.2.3
 	*
 	* @param string $haystack The text which has to be formatted.
 	* @param array $replace_pairs In the form array('from' => 'to', ...).
 	* @return string The formatted text.
 	*/
 	function wp_replace_in_html_tags( $haystack, $replace_pairs ) {

    - [Link 1](https://core.trac.wordpress.org/changeset/33359)
4. Unauthenticated Stored Cross-Site Scripting (XSS)
  - [ ] Summary: By using a large amount of text the MYSQL will truncate the input allowing for a malformed html tag allowing a hacker access			
    - Vulnerability types:XSS
    - Tested in version:4.2
    - Fixed in version: 4.2.1
  - [ ] GIF Walkthrough: https://imgur.com/a/SmU7hzl
  - [ ] Steps to recreate: 
	in the comments you place the code
<a title='x onmouseover=alert(unescape(/hello%20world/.source)) style=position:absolute;left:0;top:0;width:5000px;height:5000px  AAAAAAAAAAAA...[64 kb]..AAA'></a> 
with the 64 kb meaing you have filler worth 64 kb.
  - [ ] Affected source code:I cannot find the specific code
    - [Link 1https://core.trac.wordpress.org/browser/branches/4.2?rev=32311
1. (Optional) Vulnerability Name or ID
  - [ ] Summary: 
    - Vulnerability types:
    - Tested in version:
    - Fixed in version: 
  - [ ] GIF Walkthrough: 
  - [ ] Steps to recreate: 
  - [ ] Affected source code:
    - [Link 1](https://core.trac.wordpress.org/browser/tags/version/src/source_file.php) 

## Assets

List any additional assets, such as scripts or files

## Resources

- [WordPress Source Browser](https://core.trac.wordpress.org/browser/)
- [WordPress Developer Reference](https://developer.wordpress.org/reference/)

GIFs created with [LiceCap](http://www.cockos.com/licecap/).

imgur.com

kali Linux

## Notes

I could not find where the affected code is for my fourth exploit.
I looked for way too long.

## License

    Copyright [yyyy] [name of copyright owner]

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
